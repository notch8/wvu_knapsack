<% 
   # Get all fields that would be rendered from the flexible metadata configuration
   # view_options_for returns a Hash of field_name => options
   all_fields = view_options_for(presenter)
   
   # Convert to array for splitting
   fields_array = all_fields.to_a
   
   # Filter out admin-only fields if user is not admin
   fields_array.select! do |field, options| 
      is_admin_only = options && (options[:admin_only] || options['admin_only'])
      !is_admin_only || current_user.try(:admin?)
   end

   # Split fields into two columns. If the number of fields is odd, the left column gets the extra item.
   half = (fields_array.count / 2.0).ceil
   left_fields = fields_array[0...half]
   right_fields = fields_array[half..-1]
%>

<div class="row" <%= presenter.microdata_type_to_html %>>
  <div class="col-md-6">
    <dl class="work-show pt-3 <%= dom_class(presenter) %>">
      <% left_fields.each do |field, options| %>
        <% view_options = conform_options(field, options) %>
        <%= presenter.attribute_to_html(conform_field(field, options), view_options) %>
      <% end %>
    </dl>
  </div>
  <div class="col-md-6">
    <dl class="work-show pt-3 <%= dom_class(presenter) %>">
      <% right_fields.each do |field, options| %>
        <% view_options = conform_options(field, options) %>
        <%= presenter.attribute_to_html(conform_field(field, options), view_options) %>
      <% end %>
      
      <%# Render embargo/lease dates in the right column if they exist %>
      <%= presenter.attribute_to_html(:embargo_release_date, render_as: :date, html_dl: true) %>
      <%= presenter.attribute_to_html(:lease_expiration_date, render_as: :date, html_dl: true) %>
    </dl>
  </div>
</div>
